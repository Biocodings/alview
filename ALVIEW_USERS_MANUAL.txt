
Alview User's Manual
Latest revision March 13, 2015 

Contents.
I.   Introduction.
II.  Power User Fast Start
III. Installation and/or compilation.
IV.  Operation as Command Line Utility
V.   Operation as Web Server
VI.  General Operation
VII. alview.conf file

I. Introduction.
Alview is a fast computer program for viewing BAM files.  The most powerful
way to use the program is to use the command line and batch requests for 
very rapid viewing using a slide show.  This takes some user engagement.  
Otherwise, it is useful for browsing bam files and checking interesting 
locations as a GUI application or as a web service.
It currently supports hg18 and hg19 via large genome support files.  They are required.
More builds are forthcoming (mouse, GrCh38, etc).

Alview is available via github at https://github.com/NCIP/alview
Please note the new Windows GUI version installer.  Mac ingtaller is coming.

Alview can take three forms: 

#1 as a native standalone desktop GUI application. (Cocoa, GTK or WIN32).
#2 as a command line utility. 
#3 as a CGI web server.

It is supported on three Operating Systems:

#1 Windows 32 bit
#2 Linux (current release is 64 bit, recompilation on other target UNIX is easy) 
#3 Apple MAC 64 bit

This is relatively new, I'd appreciate feedback. Contact me at my email address : [finneyr AT mail nih gov](add @ and dots)


II.  Power User Fast Start
Alview is a webserver or command line utility or a native standalone GUI application.  For 
Windows GUI, download the installation via link on the github front page. 

Pick a directory to put alview in.   You should make a new one dedicated to Alview and it's support files.

Next download the binary for your OS: alview.exe for Windows, alvmac for Apple or alvgtk for Linux from 
the "BINARIES" directory.

Check the README.md file on the github page.  This will point to the location of the support files.
(Currently they are in m Carefully decompress and untar them.
Yes, this is a hassle. It make take a few minutes on your home DSL.

Make sure you have permissions to the files in the resulting untarred directory where the 
alview file is: alview.exe, alvmac or alvgtk need execute permissions.  The GEONMEDATA directory 
(the big download you did) must have read permission for all files.  You may need to use chmod on Apple
or Mac or icacls on Windows.

Set up "alview.conf". This must be is correct. The file "alview.conf" is 
is a text editable configuration file.  Check it carefully.

For command line or webserver, you have to compile it yourself. It's pretty 
straightforward for Linux and Apple MAC ...  

Make and/or install  1) samtools and 2)zlib if they are not already there.  
You'll need access to ".a" library files for samtools and zlib.

Typically you have to make samtools yourself.

Currently the samtools 1.1 is a bit hard to get right.
The samtools 0.1.18 is what is currently supported and works with old compilers.

Apple users may have to do the "configure/make/install" routine for some
packages as there is limited official support from Apple for many software solutions.  Linux users should
have packages easily install-able via apt-get or yum or your GUI installer.  Know in what
directories the libraries are as you'll need to provide them to the linker.  

Sources for Windows versions of the required support libraries are provided at
Alview github (zlib and samtools).  These are hacked to work with (Visual Studio's) cl.exe C/C++ compiler

A free command line version is availible. Soon. I'll try and get this by December 15.

Set the appropriate IFDEF flags.  These flags are APPLE, UNIX, WINDOWS,
WEB_SERVER, CMD_LINE  Set UNIX=1 for Linux. Set them as compiler flags.
Compile alview.cpp with proper flags and pointing to the proper libraries.   
You can compile webserver and command line statically rather than requiring 
shared libraries if you wish.

Windows users may just want the linux version; just compile linux version and 
under CYGWIN and just use CYGWIN. 

You will have to setup the genome data directory for command line version.  Set alview.conf properly.

For the webserver, copy the resulting alview to the cgi-bin directory and check permissions.
Then, set up the genome data directory and edit alview.conf properly.

Setting up the genome data directory involves this ... 
Download the large genome data support files n the tarbzip2 file named
alview_hg18hg19_genomedata.tar.bz2 
from my dropbox account at
https://www.dropbox.com/sh/ymszmksj6v83rmt/OCLsYTjgSu . 
This is large (>1GB) file and takes a while to decompress and "untar".

Use these commands

bzip2 -d alview_hg18hg19_genomedata.tar.bz2

tar xvf alview_hg18hg19_genomedata.tar 

Edit alview.conf file to point to the correct genome data location that you
just created, make sure cgi programs can access this.
If in doubt, just set it up off the executable (cgi-bin) directory and default
location will get detected.

III. Installation and/or Compilation.
At the Alview github page, check README.md file for the latest versions with 
and current instructions.  You can just install GUIs on your desktop, 
but must compile for webserver or command line.

Windows GUI: 
Download alview.exe, download GENOMEDATADIR data, edit alview.conf, check permission, run alview.exe .

APPLE MAC GUI: Download DMG files, click on it.  If there is a complaint about
Download alvmac, download GENOMEDATADIR data, edit alview.conf, check permission, run alvmac.

LINUX GUI: Download all binaries in BINARIES directory, file is "alvmac".
Download GENOMEDATADIR data, edit alview.conf, check permission, run alvmac.
Please make sure the configuration file "alview.conf" is 
set correctly to point to these large files.  This is a text file and
editable.

You must also download the large genome data support files targzipped in the
file 
named alview_hg18hg19_genomedata.tar.bz2 from my dropbox account at 
https://www.dropbox.com/sh/ymszmksj6v83rmt/OCLsYTjgSu . This is large (>1GB)
file 
and takes a while to decompress and "untar". Grab the binary and shared
libraries 
from BINARIES directory hereabouts on Github. 
The TWO command lines to prepare this file (on LINUX, Mac command line or
cygwin [ or cmd.exe with unix utilities ] ) ...

bzip2 -d alview_hg18hg19_genomedata.tar.bz2

tar xvf alview_hg18hg19_genomedata.tar 

Linux version is 64bit specific. Set up the "alview.conf" file .

Linux compilation is done vi the "gogtk" batch file.
Edit to point to your samtools.

IV.  Operation as Command Line Utility.

You must compile for standalone.  It's pretty easy.
(I'll try and get some downloadable command line binaries for you guys real soon)

Install 1 samtools, 2) curses and 3)zlib if they are 
not already there.  Set the appropriate IFDEF flags.  These flags are 
APPLE, UNIX, WINDOWS, WEB_SERVER, CMD_LINE.  You can set them via 
the command line program options as you invoke the compiler.

Example compilation on Linux for command line ...

gcc -Wall -DUNIX=1 -DCMD_LINE=1 -o alview alviewcore.cpp  -I.
-I/data/nextgen/finneyr/samtools-0.1.18/
-L/data/nextgen/finneyr/samtools-0.1.18/ -lbam -lm -lz -lgd  -lstdc++


Running alview command line ...
The command line argument are ...
    arg1 fn_bam = name of bam files (will use to determine bai file)
    arg2 outimg = output file name ( png file)
    arg3 position = example chr17:10000-10500  it can handle 17:10000-10500
type positions
    arg4 blds = build string (example "hg19")
    (optional) arg5 ih = image height
    (optional) arg6 iw = image width

So, create a batch file of BAMS and , for instance, SNP call regions to
examine.
You can view the output in a slideshow, the file "slideshowtemplate.html" is a
template file we provide for assisting in this.

Set the "IMGSHERE" and "ANOSHERE" lines with image files and annotation.  This
is a little work, but makes viewing your massive 40,000 SNP calls easy to review !!!!
This is probably the true power user's tool for reviewing his lab results and
prioritizing further work.

Actually reviewing your snp calls for anomalies can save you a lot of grief.


V.   Operation as Web Server
Compile the file alviewcore.cpp with appropriate OS flag and define 
WEBSERVER to 1.  Install binary in cgi-bin directory and run as web
application.
Example compilation:
 
g++ -DUNIX -DWEB_SERVER=1 -UQT_GUI -UCOMMAND_LINE -DNATIVE -Wall -o alview alviewcore.cpp alvmisc.cpp -lz -Wall -I${SAMTOOLSDIR} ${SAMTOOLSDIR}/libbam.a -lm -lz

Edit the list of files called "list.public" to list the full paths to your bamfiles.  Place this in the cgi-bin directory.
Example "list.public" file is ...

#This is list for PUBLIC ALVEW for NCI - public datasets - comments begine with #
/tcga_next_gen_a/bam_tier_2/GASTRIC/AGP1_RNA.bam AGP1_RNA T Asian_Gastric_RNA
/tcga_next_gen_a/bam_tier_2/GASTRIC/AGP2_RNA.bam AGP2_RNA T Asian_Gastric_RNA
/tcga_next_gen_a/bam_tier_2/GASTRIC/AGP3_RNA.bam AGP3_RNA T Asian_Gastric_RNA
/tcga_next_gen_a/bam_tier_2/GASTRIC/AGP4_RNA.bam AGP4_RNA T Asian_Gastric_RNA


VI.  Running Alview as a GUI 
Enter the genomic coordinates in the position box or a HUGO gene name.
You can select a region to zoom in.
You can use the navigation buttons to move around.
You can use the quality flag to view a grayscale graphic of the quality
values.

VII. alview.conf file

Example "alview.conf" file , this one is setup for windows...
This must be a text file, not a word file or html file.
---NEXT LINE IS FIRST LINE 
# comments stat with #
# USE / at end of directories
# windows  ...
GENOMEDATADIR=c:\rich\GENOMEDATA\
# linux  ...
#GENOMEDATADIR=/home/rfinney/GENOMEDATA/
# mac  ...
#GENOMEDATADIR=/Users/finneyr/GENOMEDATA/
---PREVIOUS LINE IS LAST LINE OF alview.conf CONFIGURATION TEXT FILE

#end

#01234567890123456789012345678901234567890123456789012345678901234567890123456789


